# Архитектура Backend

## Обзор структуры

Backend приложения теперь организован по принципам Clean Architecture с разделением на следующие слои:

```
backend/
├── controllers/          # Контроллеры (API endpoints)
├── services/            # Сервисы (бизнес-логика)
├── repositories/        # Репозитории (доступ к данным)
├── dto/                 # DTO (Data Transfer Objects)
├── models.py            # SQLAlchemy модели
├── schemas.py           # Pydantic схемы (legacy)
├── auth.py              # Аутентификация
├── database.py          # Конфигурация БД
├── main.py              # Главный файл приложения
└── requirements.txt     # Зависимости
```

## Описание слоев

### 1. DTO (Data Transfer Objects)
**Назначение**: Объекты для передачи данных между слоями

**Файлы**:
- `dto/base.py` - Базовые DTO классы
- `dto/book_dto.py` - DTO для книг и авторов
- `dto/customer_dto.py` - DTO для клиентов
- `dto/issue_dto.py` - DTO для выдач
- `dto/auth_dto.py` - DTO для аутентификации

**Принципы**:
- Отдельные DTO для создания, обновления и ответа
- Валидация данных через Pydantic
- Четкое разделение входных и выходных данных

### 2. Repositories (Репозитории)
**Назначение**: Слой доступа к данным, инкапсулирует работу с БД

**Файлы**:
- `repositories/base_repository.py` - Базовый репозиторий
- `repositories/book_repository.py` - Репозиторий для книг
- `repositories/author_repository.py` - Репозиторий для авторов
- `repositories/customer_repository.py` - Репозиторий для клиентов
- `repositories/issue_repository.py` - Репозиторий для выдач

**Принципы**:
- Один репозиторий на сущность
- CRUD операции
- Специфичные запросы для каждой сущности
- Абстракция от деталей БД

### 3. Services (Сервисы)
**Назначение**: Бизнес-логика приложения

**Файлы**:
- `services/book_service.py` - Сервис для работы с книгами
- `services/customer_service.py` - Сервис для работы с клиентами
- `services/issue_service.py` - Сервис для работы с выдачами
- `services/auth_service.py` - Сервис аутентификации

**Принципы**:
- Содержат бизнес-логику
- Используют репозитории для доступа к данным
- Преобразуют модели в DTO
- Обрабатывают исключения

### 4. Controllers (Контроллеры)
**Назначение**: API endpoints, обработка HTTP запросов

**Файлы**:
- `controllers/auth_controller.py` - Аутентификация
- `controllers/book_controller.py` - Управление книгами
- `controllers/customer_controller.py` - Управление клиентами
- `controllers/issue_controller.py` - Управление выдачами

**Принципы**:
- Только HTTP логика
- Валидация входных данных
- Обработка ошибок
- Использование сервисов

## Поток данных

```
HTTP Request → Controller → Service → Repository → Database
                ↓
HTTP Response ← DTO ← DTO ← Model ← Database
```

1. **Controller** получает HTTP запрос
2. **Controller** вызывает соответствующий **Service**
3. **Service** выполняет бизнес-логику и использует **Repository**
4. **Repository** выполняет запросы к БД
5. Данные преобразуются в **DTO** и возвращаются обратно

## Преимущества новой архитектуры

### 1. Разделение ответственности
- Каждый слой имеет четко определенную роль
- Легко тестировать каждый слой отдельно
- Изменения в одном слое не влияют на другие

### 2. Масштабируемость
- Легко добавлять новые функции
- Простое расширение API
- Возможность замены компонентов

### 3. Тестируемость
- Каждый слой можно тестировать изолированно
- Легко создавать моки для зависимостей
- Четкие интерфейсы между слоями

### 4. Поддерживаемость
- Код легче понимать и изменять
- Четкая структура проекта
- Документированные интерфейсы

## Миграция

Старый код в `main.py` был разделен на:
- **API endpoints** → `controllers/`
- **Бизнес-логика** → `services/`
- **CRUD операции** → `repositories/`
- **Схемы данных** → `dto/`

Файл `schemas.py` оставлен для обратной совместимости, но рекомендуется использовать новые DTO.

## Запуск

```bash
python main.py
```

API будет доступен по адресу: `http://localhost:8000`

Документация API: `http://localhost:8000/docs`




